{% extends "layout.html" %}
{% block title %}Packages — ApexForge Registry{% endblock %}
{% block content %}
<div class="panel p-6 mb-6">
    <form class="flex flex-wrap gap-3 items-center" method="get">
        <input type="text" name="q" value="{{ search_value }}" placeholder="Search packages…" class="flex-1 min-w-[200px] form-control" />
        <select name="sort" class="form-control bg-white">
            <option value="updated" {% if sort == "updated" %}selected{% endif %}>Recently updated</option>
            <option value="name" {% if sort == "name" %}selected{% endif %}>Name</option>
        </select>
        <select name="per_page" class="form-control bg-white">
            <option value="10" {% if per_page == 10 %}selected{% endif %}>10 per page</option>
            <option value="20" {% if per_page == 20 %}selected{% endif %}>20 per page</option>
            <option value="50" {% if per_page == 50 %}selected{% endif %}>50 per page</option>
            <option value="100" {% if per_page == 100 %}selected{% endif %}>100 per page</option>
        </select>
        <button class="btn-accent">Apply</button>
    </form>
</div>
<div class="space-y-4">
    {% for pkg in packages %}
    <article class="panel p-5">
        <div class="flex justify-between items-start gap-3 flex-wrap">
            <div>
                <h3 class="text-lg font-semibold"><a class="text-indigo-700 hover:underline" href="/package/{{ pkg.name }}">{{ pkg.name }}</a></h3>
                <p class="text-slate-500 text-sm">by <a class="hover:underline" href="/owner/{{ pkg.owner }}">{{ pkg.owner }}</a></p>
            </div>
            {% if pkg.latest_version.is_some() %}
            <span class="badge">v{{ pkg.latest_version.as_ref().unwrap() }}</span>
            {% endif %}
        </div>
        {% if pkg.description.is_some() %}
        <p class="mt-3 text-slate-600">{{ pkg.description.as_ref().unwrap() }}</p>
        {% endif %}
        {% if pkg.updated_at.is_some() %}
        <p class="text-xs text-slate-400 mt-2">Updated {{ pkg.updated_at.as_ref().unwrap() }}</p>
        {% endif %}
    </article>
    {% endfor %}
</div>
<div class="panel px-5 py-4 flex justify-between items-center mt-6 text-sm text-slate-600">
    {% if pagination.has_prev %}
    <a href="/packages?page={{ pagination.page - 1 }}&sort={{ sort }}&per_page={{ per_page }}{% if search_param.is_some() %}&q={{ search_param.as_ref().unwrap() }}{% endif %}" class="text-indigo-600 hover:underline">← Previous</a>
    {% else %}
    <span></span>
    {% endif %}
    <span>Page {{ pagination.page }} of {{ pagination.total_pages }}</span>
    {% if pagination.has_next %}
    <a href="/packages?page={{ pagination.page + 1 }}&sort={{ sort }}&per_page={{ per_page }}{% if search_param.is_some() %}&q={{ search_param.as_ref().unwrap() }}{% endif %}" class="text-indigo-600 hover:underline">Next →</a>
    {% else %}
    <span></span>
    {% endif %}
</div>
{% endblock %}
