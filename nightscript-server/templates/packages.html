{% extends "layout.html" %}
{% block title %}Packages — ApexForge Registry{% endblock %}
{% block content %}
<div class="bg-white shadow rounded-lg p-6 mb-6">
    <form class="flex flex-wrap gap-3" method="get">
        <input type="text" name="search" value="{{ search_value }}" placeholder="Search packages…" class="flex-1 min-w-[200px] border rounded px-4 py-2" />
        <select name="sort" class="border rounded px-3 py-2">
            <option value="recent" {% if sort == "recent" %}selected{% endif %}>Recently updated</option>
            <option value="name" {% if sort == "name" %}selected{% endif %}>Name</option>
        </select>
        <button class="bg-indigo-600 text-white px-4 py-2 rounded">Apply</button>
    </form>
</div>
<div class="space-y-4">
    {% for pkg in packages %}
    <article class="bg-white shadow rounded-lg p-5">
        <div class="flex justify-between items-start gap-3">
            <div>
                <h3 class="text-lg font-semibold"><a class="text-indigo-700 hover:underline" href="/package/{{ pkg.name }}">{{ pkg.name }}</a></h3>
                <p class="text-slate-500 text-sm">by <a class="hover:underline" href="/owner/{{ pkg.owner }}">{{ pkg.owner }}</a></p>
            </div>
            {% if pkg.latest_version.is_some() %}
            <span class="text-xs bg-slate-100 px-3 py-1 rounded-full">v{{ pkg.latest_version.as_ref().unwrap() }}</span>
            {% endif %}
        </div>
        {% if pkg.description.is_some() %}
        <p class="mt-3 text-slate-600">{{ pkg.description.as_ref().unwrap() }}</p>
        {% endif %}
        {% if pkg.updated_at.is_some() %}
        <p class="text-xs text-slate-400 mt-2">Updated {{ pkg.updated_at.as_ref().unwrap() }}</p>
        {% endif %}
    </article>
    {% endfor %}
</div>
<div class="flex justify-between items-center mt-6 text-sm text-slate-600">
    {% if pagination.has_prev %}
    <a href="/packages?page={{ pagination.page - 1 }}&sort={{ sort }}{% if search_param.is_some() %}&search={{ search_param.as_ref().unwrap() }}{% endif %}" class="text-indigo-600 hover:underline">← Previous</a>
    {% else %}
    <span></span>
    {% endif %}
    <span>Page {{ pagination.page }} of {{ pagination.total_pages }}</span>
    {% if pagination.has_next %}
    <a href="/packages?page={{ pagination.page + 1 }}&sort={{ sort }}{% if search_param.is_some() %}&search={{ search_param.as_ref().unwrap() }}{% endif %}" class="text-indigo-600 hover:underline">Next →</a>
    {% else %}
    <span></span>
    {% endif %}
</div>
{% endblock %}
