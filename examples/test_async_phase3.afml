import forge.log as log;
import forge.async as async;

fun apex() {
    // Test async sleep
    log.info("Starting async operations...");
    
    let future1 = async.sleep(100);
    let result1 = await future1;
    log.info("Sleep completed");
    
    // Test timeout
    let timeout_future = async.timeout(50, fun() { log.info("Timeout callback executed!"); });
    let result2 = await timeout_future;
    log.info("Timeout completed");
    
    // Test parallel execution
    let tasks = [
        fun() { log.info("Task 1 completed"); 42 },
        fun() { log.info("Task 2 completed"); 100 },
        fun() { log.info("Task 3 completed"); 200 }
    ];
    
    let parallel_result = async.parallel(tasks);
    let result3 = await parallel_result;
    log.info("Parallel tasks completed");
    
    // Test race execution
    let race_tasks = [
        fun() { log.info("Race task 1"); 1 },
        fun() { log.info("Race task 2"); 2 }
    ];
    
    let race_result = async.race(race_tasks);
    let result4 = await race_result;
    log.info("Race tasks completed");
    
    log.info("All async operations completed!");
}
